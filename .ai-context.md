# API Backend - AI Context File

> Backend API development context for Netanel Klein's portfolio system

## ğŸ”Œ API Repository Overview

**Repository**: `netanelklein/netanel-homepage-api` (Public)  
**Purpose**: Vanilla PHP backend API serving both portfolio and admin applications  
**Domain**: `https://netanelk.com/api/`  
**Tech Stack**: Vanilla PHP + Oracle HeatWave MySQL + Oracle Linux 9 ARM VM  
**Production Status**: âœ… **LIVE IN PRODUCTION**

## ğŸ—ï¸ Current Project Structure

```
api/
â”œâ”€â”€ ğŸ“ Core Application
â”‚   â”œâ”€â”€ index.php                   # Main entry point
â”‚   â”œâ”€â”€ .htaccess                   # Apache URL rewriting
â”‚   â”œâ”€â”€ .env                        # Environment configuration (local)
â”‚   â”œâ”€â”€ config/                     # Application configuration
â”‚   â”‚   â”œâ”€â”€ app.php                 # Main app config
â”‚   â”‚   â”œâ”€â”€ database.php            # Database configuration
â”‚   â”‚   â””â”€â”€ env/                    # Environment templates
â”‚   â”œâ”€â”€ routes/                     # API route definitions
â”‚   â”œâ”€â”€ src/                        # Source code
â”‚   â”‚   â”œâ”€â”€ controllers/            # API controllers
â”‚   â”‚   â”œâ”€â”€ models/                 # Data models
â”‚   â”‚   â”œâ”€â”€ core/                   # Core utilities (Database, Request, Response)
â”‚   â”‚   â”œâ”€â”€ services/               # Business logic services
â”‚   â”‚   â””â”€â”€ middleware/             # HTTP middleware
â”‚   â”œâ”€â”€ database/                   # Database schema and migrations
â”‚   â””â”€â”€ storage/                    # Logs, cache, uploads
â”‚
â”œâ”€â”€ ğŸ³ Docker & Kubernetes
â”‚   â”œâ”€â”€ Dockerfile                  # Container build configuration
â”‚   â”œâ”€â”€ docker-compose.yml          # Local development environment
â”‚   â”œâ”€â”€ docker/                     # Container configurations
â”‚   â””â”€â”€ nginx.conf                  # Nginx web server config
â”‚
â”œâ”€â”€ ğŸ“š Documentation & Config
â”‚   â”œâ”€â”€ README.md                   # Project documentation
â”‚   â”œâ”€â”€ .ai-context.md             # This file
â”‚   â””â”€â”€ docs/                       # Additional documentation
â”‚
â”œâ”€â”€ ğŸ› ï¸ Development Scripts
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ deployment/             # Deployment automation scripts
â”‚       â”œâ”€â”€ monitoring/             # Monitoring and health check scripts
â”‚       â””â”€â”€ development/            # Development utilities
â”‚           â”œâ”€â”€ create-db-user.sh   # Database setup
â”‚           â”œâ”€â”€ setup-database.sh   # Database initialization
â”‚           â”œâ”€â”€ start-server.sh     # Local dev server
â”‚           â””â”€â”€ test-*.php/.sh      # Testing utilities
â”‚
â””â”€â”€ ğŸ”§ CI/CD & Infrastructure
    â”œâ”€â”€ .github/                    # GitHub Actions workflows
    â”œâ”€â”€ k8s/                        # Kubernetes manifests
    â””â”€â”€ .gitignore                  # Git ignore rules
```

## ğŸ¯ Current Development Status

**âœ… PRODUCTION DEPLOYMENT - LIVE AND STABLE**

### Current State (December 27, 2024)
- **âœ… Production Server**: Oracle Linux 9 ARM VM with Nginx + PHP-FPM
- **âœ… SSL Security**: Let's Encrypt certificates installed and configured  
- **âœ… Database**: Oracle HeatWave MySQL with populated production data
- **âœ… API Endpoints**: All endpoints live and functional at https://netanelk.com/api/
- **âœ… Data Transformation**: Complete alignment with Flutter model expectations
- **âœ… Privacy Compliance**: Sensitive data removed from public API responses
- **âœ… Frontend Integration**: Flutter app successfully consuming live production data
- **âœ… Performance**: Optimized PHP-FPM and Nginx configuration for production
- **âœ… Environment**: Production .env configuration with external database credentials

### Production API Status Summary
- **Portfolio Endpoints**: âœ… All working perfectly in production (https://netanelk.com/api/portfolio/*)
- **Health Endpoints**: âœ… All working perfectly (https://netanelk.com/api/health)
- **Contact Endpoint**: âœ… Working with validation (https://netanelk.com/api/contact)
- **Auth Endpoints**: âœ… Working, returns expected 401 for unauthenticated requests
- **CV Download**: âœ… Working (https://netanelk.com/api/cv/download)
- **Admin Dashboard**: âœ… All core endpoints functional (authentication required)

### Production Integration Status
- **âœ… API Server**: Live at `https://netanelk.com/api/` with SSL
- **âœ… Flutter Frontend**: Live at `https://netanelk.com` consuming production API
- **âœ… Database**: Oracle HeatWave MySQL with dedicated user and populated data
- **âœ… SSL/TLS**: Let's Encrypt certificates with automatic renewal
- **âœ… Response Format**: Perfectly matches Flutter model expectations
- **âœ… Live Data Flow**: Frontend successfully displays real production API data
- **âœ… Privacy**: Sensitive data (email, phone) removed from public endpoints

### Key Production Implementations
1. **Database Connection**: Oracle HeatWave MySQL integration with proper PDO configuration
2. **Data Transformation**: Complete PHP transformation functions for camelCase output
3. **Privacy Compliance**: Removed email, phone, and other sensitive data from public responses
4. **Skills Formatting**: Fixed transformation from database to Flutter-compatible structure
5. **SSL Security**: HTTPS endpoints with Let's Encrypt certificates
6. **Nginx Configuration**: Proper routing for `/api/*` requests to PHP front controller
7. **Environment Security**: Production .env file with secure database credentials
8. **Performance**: PHP-FPM tuning and Nginx caching for optimal response times

### Production Deployment Architecture
- **Server**: Oracle Linux 9 ARM VM (OCI)
- **Web Server**: Nginx with custom configuration for API routing
- **PHP Runtime**: PHP-FPM with all required extensions
- **Database**: External Oracle HeatWave MySQL database
- **SSL**: Let's Encrypt certificates with automatic renewal
- **Security**: SELinux configured, proper file permissions, secure database connection

### Next Steps
- **âœ… Production Ready**: API fully deployed and stable in production environment
- **âœ… Frontend Integration**: Live data serving Flutter frontend successfully  
- **ğŸ”„ Admin Panel**: Ready to begin admin interface development
- **ğŸ”„ Monitoring**: Implement production monitoring and logging systems
- **ğŸ”„ Performance**: Add caching layers and performance optimizations
- **ğŸ”„ Features**: Extend API with additional portfolio management capabilities
- **Ready for Production Deployment**: Core functionality stable

### Current Working Directory
```
api/
â”œâ”€â”€ âœ… src/controllers/         # All controllers fixed and functional
â”œâ”€â”€ âœ… src/models/             # Database models working properly  
â”œâ”€â”€ âœ… src/core/               # Core classes (Database, Router, Response) fixed
â”œâ”€â”€ âœ… database/               # Schema and sample data populated
â”œâ”€â”€ âœ… config/                 # Configuration files updated
â””â”€â”€ âœ… middleware/             # CORS and other middleware working
```
- **Framework**: Vanilla PHP (no frameworks) for resource efficiency
- **Database**: MySQL on Oracle Cloud Infrastructure
- **Hosting**: Oracle Kubernetes Engine (OKE) for learning, VM for cost optimization
- **Security**: Session-based authentication + rate limiting + input validation

## ğŸ“‹ API Implementation Overview

### MVC Architecture
- **Entry Point**: `index.php` (autoloading, config, routing)
- **Routes**: `routes/api.php` (URL mapping to controllers)
- **Controllers**: Extend `BaseController` with common functionality
- **Models**: Extend `BaseModel` with database connection
- **Services**: Business logic and utilities (validation, logging, caching)
- **Middleware**: Cross-cutting concerns (auth, rate limiting)

### Key Controllers
- **`PortfolioController`**: Public portfolio data endpoints
- **`AdminController`**: Complete admin panel CRUD operations
- **`AuthController`**: Admin authentication and session management

### Caching Strategy
- **Database Query Caching**: Redis preferred, file-based fallback
- **Application Caching**: File-based via `CacheService`
- **Performance**: Optimized for Oracle ARM architecture

## ğŸ” Security Features

### Authentication & Authorization
- Session-based admin authentication
- Password hashing with bcrypt
- Protected admin routes via middleware

### Rate Limiting & Protection
- IP-based rate limiting by endpoint category
- Input validation and sanitization
- CORS handling and security headers
- Contact form spam protection

## ğŸ—„ï¸ Database Schema

### Core Tables
- `personal_info`: Basic personal information (single row)
- `projects`: Portfolio projects with status and priority
- `skills`: Skills with categories and proficiency levels
- `experience`: Work experience timeline
- `education`: Educational background
- `contact_messages`: Contact form submissions with metadata
- `admin_users`: Admin authentication
- `admin_logs`: Activity audit trail

## ğŸ“ Development Status: PRODUCTION READY âœ…

### âœ… Completed Features
- **Core API**: All endpoints implemented and tested
- **Security**: Authentication, rate limiting, input validation
- **Performance**: Caching, query optimization, ARM compatibility
- **Admin Panel**: Complete content management system
- **Documentation**: API docs and deployment guides
- **Infrastructure**: Docker, Kubernetes, OCI deployment scripts

### Recent Code Review (June 2025, Gemini Pro)
**Overall Assessment**: Well-designed API with good practices. Clear MVC structure, comprehensive security, dual caching strategy, and modular service layer.

**Strengths**:
- Clean separation of concerns
- Security-first approach (password hashing, rate limiting, PDO)
- Performance optimizations (Redis/file caching)
- Comprehensive middleware implementation

**Future Enhancements** (not critical):
- Consider dependency injection for larger scale
- Minimize global state usage
- Add comprehensive test suite
- Implement API versioning

## ğŸš€ Deployment Options

### Current: Oracle Kubernetes Engine (OKE)
- **Purpose**: Learning and showcasing K8s skills
- **Features**: Container orchestration, auto-scaling, high availability
- **Cost**: Higher but within learning budget

### Future: Oracle VM Migration
- **Purpose**: Cost optimization for production
- **Features**: Simple VM deployment, resource efficient
- **Cost**: Minimal, suitable for long-term operation

### Local Development
- **Docker Compose**: Full development environment
- **Testing**: Automated API testing scripts
- **CI/CD**: Ready for integration with deployment automation

---

*Last updated: June 2025 - Post code review and documentation cleanup*
